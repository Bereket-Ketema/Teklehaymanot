<!DOCTYPE html>
<html lang="am">
<head>
  <meta charset="UTF-8">
  <title>рІерЅ░рѕўрІўрїѕрЅА ріГрѕГрѕхрЅ▓рІФріќрЅй</title>
  <link rel="stylesheet" href="css/baptism.css">
</head>
<body>

  <header>
    <h1>­ЪЉЦ рІерЅ░рѕўрІўрїѕрЅА ріГрѕГрѕхрЅ▓рІФріќрЅй</h1>
    <button onclick="logout()">­Ъџф рІЇрїБ</button>
  </header>

  <div class="container">
    <h2>рѕўрѕерїЃ рІЮрѕГрІЮрѕГ</h2>

    <table id="membersTable">
      <thead>
        <tr>
          <th>рѕхрѕЮ</th>
          <th>рІеріарЅБрЅх рѕхрѕЮ</th>
          <th>рІеріЦріЊрЅх рѕхрѕЮ</th>
          <th>рІеріарІФрЅх рѕхрѕЮ</th>
          <th>рІеріГрѕГрѕхрЅхріЊ рѕхрѕЮ</th>
          <th>рІеріГрѕГрѕхрЅхріЊ ріарЅБрЅх рѕхрѕЮ</th>
          <th>рЇєрЅ│</th>
          <th>рІерЅхрІЇрѕЇрІх рЅђріЋ</th>
          <th>ріГрѕГрѕхрЅхріЊ рІерЅ░ріљрѕ│рЅарЅх рЅђріЋ</th>
          <th>рІерѕЏрѕхрїѕрЅБрЅх рЅђріЋ</th>
          <th>рЇірѕГрѕЏ</th>
          <th>ріарѕхрІѕрїЇрІх</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td colspan="10" class="no-data">РЈ│ рѕўрѕерїЃ рЅарѕўрѕўрїБрЅх рѕІрІГ...</td>
        </tr>
      </tbody>
    </table>
  </div>

  <script>
    
    window.addEventListener("pageshow", function (event) {
      if (event.persisted || performance.getEntriesByType("navigation")[0].type === "back_forward") {
        if (sessionStorage.getItem("isAdminLoggedIn") !== "true") {
          window.location.href = "../admin.html";
        }
      }
    });

    function loadMembers() {
      fetch('/getbaptism')
        .then(res => res.json())
        .then(data => {
          const tbody = document.querySelector('#membersTable tbody');
          tbody.innerHTML = '';

          if (data.length === 0) {
            tbody.innerHTML = '<tr><td colspan="10" class="no-data">­ЪџФ рѕўрѕерїЃ ріарѕЇрЅ░рїѕріўрѕЮрЇб</td></tr>';
            return;
          }

          data.forEach(member => {
            const row = `
              <tr>
                <td>${member['рѕхрѕЮ'] || ''}</td>
                <td>${member['рІеріарЅБрЅх_рѕхрѕЮ'] || ''}</td>
                <td>${member['рІеріЦріЊрЅх_рѕхрѕЮ'] || ''}</td>
                <td>${member['рІеріарІФрЅх_рѕхрѕЮ'] || ''}</td>
                <td>${member['рІеріГрѕГрѕхрЅхріЊ_рѕхрѕЮ'] || ''}</td>
                <td>${member['рІеріГрѕГрѕхрЅхріЊ_ріарЅБрЅх_рѕхрѕЮ'] || ''}</td>
                <td>${member['рЇєрЅ│'] || ''}</td>
                <td>${member['рІерЅхрІЇрѕЇрІх_рЅђріЋ'] || ''}</td>
                <td>${member['ріГрѕГрѕхрЅхріЊ_рІерЅ░ріљрѕ│рЅарЅх_рЅђріЋ'] || ''}</td>
                <td>${member['рІерѕЏрѕхрїѕрЅБрЅх_рЅђріЋ'] || ''}</td>
                <td>${member['рЇірѕГрѕЏ'] || ''}</td>
                <td><button onclick="deletePerson(${member.id})">­ЪЌЉ№ИЈ</button></td>
              </tr>
            `;
            tbody.innerHTML += row;
          });
        })
        .catch(err => {
          console.error("­Ъџе Fetch error:", err);
          alert("РЮї рѕўрѕерїЃ рѕЏрѕхрѕўрїБрЅх ріарѕЇрЅ░рѕ│ріФрѕЮрЇб");
        });
    }

    function logout() {
      // ­Ъћљ You can clear session/localStorage if using authentication
      alert("­Ъџф рЅарЅ░рѕ│ріФ рѕЂріћрЅ│ рІѕрїЦрЅ░рІІрѕЇрЇб");
      window.location.href = "/admin.html"; // redirect to login
    }

    function deletePerson(id) {
      if (confirm("ріЦрѕГрїЇрїаріЏ ріљрѕЁ ріЦріЋрІ░рѕЮрЅ│рѕхрІѕрїЇрІх?")) {
        fetch(`/api/baptist/${id}`, { method: 'DELETE' })
          .then(() => location.reload());
      }
    }

    window.onload = loadMembers;
  </script>

</body>
</html>
